<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é¡¹ç›®ç”Ÿå‘½å‘¨æœŸç”Ÿæˆå™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script>
      function saveEdit(id) {
        const name = document.getElementById("edit-name").value.trim();
        const owner = document.getElementById("edit-owner").value.trim();
        const desc = document.getElementById("edit-desc").value.trim();
        const actualEnd = document.getElementById("edit-actualEnd").value;
        const currentDate = new Date().toISOString().split('T')[0];
        
        if (actualEnd && actualEnd > currentDate) {
            return alert("å®é™…å®Œæˆæ—¶é—´ä¸èƒ½å¤§äºå½“å‰æ—¶é—´");
        }
      
        const t = tasks.find((t) => t.id === id);
        if (t) {
          t.name = name;
          t.owner = owner;
          t.desc = desc;
          t.actualEnd = actualEnd;
          renderGantt();
          generateProjectReport();
          document.querySelector(".popup-wrapper").remove();
        }
      }

      function confirmDelete(id) {
        if (!confirm("ç¡®å®šè¦åˆ é™¤è¯¥ä»»åŠ¡ï¼Ÿ")) return;
        tasks = tasks.filter((t) => t.id !== id);
        renderGantt();
        document.querySelector(".popup-wrapper").remove();
      }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      .bar-green .bar {
        fill: #10b981 !important;
      }
      .bar-blue .bar {
        fill: #3b82f6 !important;
      }
      .bar-red .bar {
        fill: #ef4444 !important;
      }
      .bar-orange .bar {
        fill: #f97316 !important;
      }
      .gantt .bar-wrapper:hover .bar {
        stroke-width: 3;
        stroke: #333;
      }
      .gantt .popup-wrapper {
        display: none;
        z-index: 1000; /* æ·»åŠ z-indexé¿å…è¢«å…¶ä»–å…ƒç´ è¦†ç›– */
      }
      .gantt .bar-wrapper:hover .popup-wrapper {
        display: block;
      }
      </style>
      
    </style>
    <script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
  </head>
  <body class="bg-gray-100 p-6">
    <div id="capture" class="max-w-6xl mx-auto bg-white rounded-xl shadow p-6">
      <h1 class="text-2xl font-bold mb-6">ğŸ“… é¡¹ç›®ä»»åŠ¡ç”˜ç‰¹å›¾ç”Ÿæˆå™¨</h1>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
          <label class="text-sm">ä»»åŠ¡åç§°</label
          ><input
            id="taskName"
            class="w-full border px-2 py-1 rounded"
            placeholder="å¦‚ï¼šéœ€æ±‚åˆ†æ"
          />
        </div>
        <div>
          <label class="text-sm">è´Ÿè´£äºº</label
          ><input id="taskOwner" class="w-full border px-2 py-1 rounded" />
        </div>
        <div>
          <label class="text-sm">é¢œè‰²</label
          ><select id="taskColor" class="w-full border px-2 py-1 rounded">
            <option value="green" selected>ç»¿è‰²</option>
            <option value="blue">è“è‰²</option>
            <option value="red">çº¢è‰²</option>
            <option value="orange">æ©™è‰²</option>
          </select>
        </div>
        <div>
          <label class="text-sm">å¼€å§‹æ—¥æœŸ</label
          ><input
            type="date"
            id="taskStart"
            class="w-full border px-2 py-1 rounded"
          />
        </div>
        <div>
          <label class="text-sm">ç»“æŸæ—¥æœŸ</label
          ><input
            type="date"
            id="taskEnd"
            class="w-full border px-2 py-1 rounded"
          />
        </div>
        <!-- <div>
          <label class="text-sm">å®é™…å®Œæˆ</label
          ><input
            type="date"
            id="taskActualEnd"
            class="w-full border px-2 py-1 rounded"
          />
        </div> -->
        <div class="md:col-span-3">
          <label class="text-sm">æè¿°</label
          ><textarea
            id="taskDesc"
            class="w-full border px-2 py-1 rounded"
          ></textarea>
        </div>
      </div>

      <div class="flex justify-between items-center mb-4">
        <div class="relative inline-block text-left">
          <button
            id="exportMenuButton"
            type="button"
            class="px-4 py-2 border bg-white text-sm rounded-md"
            onclick="toggleExportMenu()"
          >
            ğŸ› ï¸ æ‹“å±•åŠŸèƒ½
          </button>
          <div
            id="exportMenu"
            class="absolute mt-2 w-56 hidden rounded bg-white border shadow z-10"
          >
            <button
              onclick="generateProjectReport()"
              class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100"
            >
              ğŸ“Š ç”Ÿæˆé¡¹ç›®åˆ†ææŠ¥å‘Š
            </button>
            <button
              onclick="downloadProjectReport()"
              class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100"
            >
              ğŸ“¥ ä¸‹è½½é¡¹ç›®åˆ†ææŠ¥å‘Š
            </button>
            <button
              onclick="copyGantt()"
              class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100"
            >
              ğŸ’¾ ä¿å­˜å›¾åƒ
            </button>
            <button
              onclick="exportData()"
              class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100"
            >
              ğŸ“¤ å¯¼å‡ºæ•°æ®
            </button>
            <label
              class="block px-4 py-2 text-sm hover:bg-gray-100 cursor-pointer"
            >
              ğŸ“¥ å¯¼å…¥æ•°æ®<input
                type="file"
                id="importFile"
                accept=".json"
                onchange="importData(event)"
                hidden
              />
            </label>
          </div>
        </div>
        <button
          onclick="addTask()"
          class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
        >
          â• æ·»åŠ ä»»åŠ¡
        </button>
      </div>

      <div id="gantt" class="overflow-x-auto"></div>
      <div
        id="summary"
        class="mt-6 p-4 border bg-gray-50 text-sm text-gray-800 rounded"
      ></div>
    </div>

    <script>
      let tasks = [];
      let gantt;

      function toggleExportMenu() {
        const exportMenu = document.getElementById("exportMenu");
        if (exportMenu) {
          exportMenu.classList.toggle("hidden");
        }
      }

      // ä½¿ç”¨äº‹ä»¶å§”æ‰˜ä¼˜åŒ–äº‹ä»¶ç»‘å®š
      document.body.addEventListener("click", function(e) {
        if (e.target.matches("#exportMenuButton")) {
          toggleExportMenu();
        }
        // ç‚¹å‡»å…¶ä»–åœ°æ–¹æ—¶å…³é—­èœå•
        if (!e.target.closest("#exportMenu") && !e.target.matches("#exportMenuButton")) {
          const exportMenu = document.getElementById("exportMenu");
          if (exportMenu && !exportMenu.classList.contains("hidden")) {
            exportMenu.classList.add("hidden");
          }
        }
      });

      function addTask() {
          const name = taskName.value.trim();
          const start = taskStart.value;
          const end = taskEnd.value;
          const color = taskColor.value;
          const desc = taskDesc.value.trim();
          const owner = taskOwner.value.trim();
      
          if (!name || !start || !end) {
              return alert("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯");
          }
          // Convert to Date objects for comparison
          const startDate = new Date(start);
          const endDate = new Date(end);
      
          if (startDate > endDate) {
              return alert("å¼€å§‹ä¸èƒ½æ™šäºç»“æŸ");
          }
      
          tasks.push({
              id: "t-" + Date.now(),
              name,
              start,
              end,
              custom_class: color,
              desc,
              owner,
              progress: 0,
          });
          renderGantt();
          generateProjectReport(); // æ·»åŠ ä»»åŠ¡åè‡ªåŠ¨æ›´æ–°æŠ¥å‘Š
      }

      function renderGantt() {
        document.getElementById("gantt").innerHTML = "";
        gantt = new Gantt(
          "#gantt",
          tasks.map((t) => ({
            ...t,
            custom_class: `bar-${t.custom_class}`,
          })),
          {
            view_mode: "Day",
            on_click: (task) => {
              const popup = document.querySelector(".popup-wrapper");
              if (popup) popup.remove();

              const div = document.createElement("div");
              div.className =
                "popup-wrapper fixed z-50 top-0 left-0 w-full h-full flex items-center justify-center bg-black bg-opacity-30";
              div.innerHTML = `
          <div class='bg-white p-4 rounded-lg shadow-xl w-80'>
            <h2 class='font-bold text-lg mb-2'>ç¼–è¾‘ä»»åŠ¡ï¼š${task.name}</h2>
            <label class='text-sm block mb-1'>ä»»åŠ¡åç§°</label>
            <input class='w-full border mb-2 px-2 py-1 rounded' value="${task.name}" id="edit-name" />
            <label class='text-sm block mb-1'>è´Ÿè´£äºº</label>
            <input class='w-full border mb-2 px-2 py-1 rounded' value="${task.owner}" id="edit-owner" />
            <label class='text-sm block mb-1'>å®é™…å®Œæˆæ—¶é—´</label>
            <input type="date" class='w-full border mb-2 px-2 py-1 rounded' value="${task.actualEnd || ''}" id="edit-actualEnd" />
            <label class='text-sm block mb-1'>æè¿°</label>
            <textarea class='w-full border mb-2 px-2 py-1 rounded' id="edit-desc">${task.desc}</textarea>
            <div class='flex justify-between mt-4'>
              <button onclick="saveEdit('${task.id}')" class='bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700'>ä¿å­˜</button>
              <button onclick="confirmDelete('${task.id}')" class='bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700'>åˆ é™¤</button>
              <button onclick="document.querySelector('.popup-wrapper').remove()" class='border px-3 py-1 rounded'>å–æ¶ˆ</button>
            </div>
          </div>
        `;
              document.body.appendChild(div);
            },
            on_dblclick: (task) => {
              const bar = task._element?.group?.node;
              if (!bar) return;
              const existing = document.getElementById(`delete-btn-${task.id}`);
              if (existing) existing.remove();
              const btn = document.createElement("button");
              btn.textContent = "âœ–";
              btn.id = `delete-btn-${task.id}`;
              Object.assign(btn.style, {
                position: "absolute",
                background: "red",
                color: "white",
                border: "none",
                borderRadius: "9999px",
                cursor: "pointer",
                fontSize: "12px",
                padding: "0 6px",
                zIndex: 9999,
              });
              const rect = bar.getBoundingClientRect();
              btn.style.top = `${rect.top + window.scrollY}px`;
              btn.style.left = `${rect.right + window.scrollX - 10}px`;
              btn.onclick = () => {
                if (!confirm("ç¡®å®šåˆ é™¤ä»»åŠ¡ï¼Ÿ")) return;
                tasks = tasks.filter((t) => t.id !== task.id);
                document.body.removeChild(btn);
                renderGantt();
              };
              document.body.appendChild(btn);
              setTimeout(
                () =>
                  document.body.contains(btn) && document.body.removeChild(btn),
                4000
              );
            },
            custom_popup_html: (task) => {
              const days =
                Math.ceil(
                  (new Date(task.end) - new Date(task.start)) / 86400000
                ) + 1;
              const delayInfo = task.actualEnd
                ? new Date(task.actualEnd) > new Date(task.end)
                  ? " â° å»¶æœŸ"
                  : " âœ… æå‰"
                : "";
              return `<div class='bg-white p-2 border rounded w-56'><b>${
                task.name
              }${delayInfo}</b><br>${task.start} ~ ${
                task.end
              }<br>ğŸ•’ ${days} å¤©<br>è´Ÿè´£äººï¼š${
                task.owner || "æœªæŒ‡å®š"
              }<br>å®Œæˆï¼š${task.actualEnd || "æœªå¡«å†™"}<br>${
                task.desc || ""
              }</div>`;
            },
            // æ·»åŠ æ‹–æ‹½åŠŸèƒ½
            bar_drag: true,
            on_date_change: function(task, start, end) {
              // æ›´æ–°ä»»åŠ¡çš„å¼€å§‹å’Œç»“æŸæ—¥æœŸ
              const taskObj = tasks.find(t => t.id === task.id);
              if (taskObj) {
                // æ ¼å¼åŒ–æ—¥æœŸä¸ºYYYY-MM-DDæ ¼å¼
                taskObj.start = formatDate(start);
                taskObj.end = formatDate(end);
                
                // å¦‚æœæœ‰å®é™…å®Œæˆæ—¥æœŸï¼Œæ£€æŸ¥æ˜¯å¦å»¶æœŸ
                if (taskObj.actualEnd) {
                  const actualEndDate = new Date(taskObj.actualEnd);
                  const endDate = new Date(taskObj.end);
                  
                  // è‡ªåŠ¨è®¡ç®—æ˜¯å¦å»¶æœŸ
                  if (actualEndDate > endDate) {
                    console.log(`ä»»åŠ¡ "${taskObj.name}" å·²å»¶æœŸ`);
                  } else {
                    console.log(`ä»»åŠ¡ "${taskObj.name}" æŒ‰æ—¶å®Œæˆ`);
                  }
                }
                
                // æ›´æ–°é¡¹ç›®æŠ¥å‘Š
                generateProjectReport();
              }
            }
          }
        );
      }

      // çœç•¥ copyGantt / exportData / importData / generateMarkdownReport å·²é›†æˆ
    </script>
  </body>
</html>

<script>
  // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–å›¾è¡¨
  window.addEventListener('load', function() {
    if (tasks.length > 0) {
      generateProjectReport();
    }
  });
  function generateProjectReport() {
    let delayedTasks = 0;
    let completedTasks = 0;
    let totalTasks = tasks.length;
    
    // ä½¿ç”¨æ›´ç°ä»£åŒ–çš„å¸ƒå±€å’Œæ ·å¼
    let reportContent = "<div class='space-y-8'>";
    reportContent += "<h1 class='text-3xl font-bold mb-6 text-gray-800 border-b pb-2'>ğŸ“Š é¡¹ç›®åˆ†ææŠ¥å‘Š</h1>";
    
    // é¡¹ç›®æ¦‚å†µéƒ¨åˆ† - ç§»åˆ°æœ€ä¸Šæ–¹
    reportContent += "<section class='bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300'>";
    reportContent += "<h2 class='text-xl font-semibold mb-4 text-gray-700 flex items-center'><span class='mr-2'>ğŸ“ˆ</span>é¡¹ç›®æ¦‚å†µ</h2>";
    reportContent += "<div class='grid grid-cols-2 md:grid-cols-4 gap-4'>";
    
    // ä½¿ç”¨æ›´å¸å¼•äººçš„å¡ç‰‡è®¾è®¡
    reportContent += `<div class='p-4 bg-blue-50 rounded-lg shadow hover:shadow-md transition-all duration-300 transform hover:-translate-y-1'>
                        <p class='text-sm font-medium text-blue-700'>æ€»ä»»åŠ¡æ•°</p>
                        <p class='text-3xl font-bold text-blue-800'>${totalTasks}</p>
                      </div>`;
    reportContent += `<div class='p-4 bg-green-50 rounded-lg shadow hover:shadow-md transition-all duration-300 transform hover:-translate-y-1'>
                        <p class='text-sm font-medium text-green-700'>å·²å®Œæˆ</p>
                        <p class='text-3xl font-bold text-green-800'>${completedTasks}</p>
                      </div>`;
    reportContent += `<div class='p-4 bg-red-50 rounded-lg shadow hover:shadow-md transition-all duration-300 transform hover:-translate-y-1'>
                        <p class='text-sm font-medium text-red-700'>å»¶æœŸ</p>
                        <p class='text-3xl font-bold text-red-800'>${delayedTasks}</p>
                      </div>`;
    reportContent += `<div class='p-4 bg-yellow-50 rounded-lg shadow hover:shadow-md transition-all duration-300 transform hover:-translate-y-1'>
                        <p class='text-sm font-medium text-yellow-700'>è¿›è¡Œä¸­</p>
                        <p class='text-3xl font-bold text-yellow-800'>${totalTasks - completedTasks}</p>
                      </div>`;
    reportContent += "</div>";
    reportContent += "</section>";

    // å›¾è¡¨éƒ¨åˆ† - æ›´å¥½çš„å¸ƒå±€
    reportContent += "<section class='bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 mt-6'>";
    reportContent += "<h2 class='text-xl font-semibold mb-4 text-gray-700 flex items-center'><span class='mr-2'>ğŸ“Š</span>ä»»åŠ¡çŠ¶æ€åˆ†å¸ƒ</h2>";
    reportContent += "<div class='grid grid-cols-1 lg:grid-cols-2 gap-8'>";
    reportContent += "<div id='chartContainer' style='height: 300px; width: 100%;'></div>";
    reportContent += "<div id='timelineChart' style='height: 300px; width: 100%;'></div>";
    reportContent += "</div>";
    reportContent += "</section>";
    
    // ä»»åŠ¡è¯¦æƒ…éƒ¨åˆ† - æ›´å¥½çš„å¡ç‰‡è®¾è®¡
    reportContent += "<section class='bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 mt-6'>";
    reportContent += "<h2 class='text-xl font-semibold mb-4 text-gray-700 flex items-center'><span class='mr-2'>ğŸ“‹</span>ä»»åŠ¡è¯¦æƒ…</h2>";
    reportContent += "<div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4'>";
    
    tasks.forEach((task) => {
      const isDelayed = task.actualEnd && new Date(task.actualEnd) > new Date(task.end);
      const isCompleted = task.actualEnd && new Date(task.actualEnd) <= new Date(task.end);

      if (isDelayed) delayedTasks++;
      if (isCompleted) completedTasks++;

      // æ›´ç¾è§‚çš„ä»»åŠ¡å¡ç‰‡
      const statusColor = isDelayed
        ? "bg-red-50 border-red-200"
        : isCompleted
        ? "bg-green-50 border-green-200"
        : "bg-blue-50 border-blue-200";
        
      const statusIcon = isDelayed
        ? "â°"
        : isCompleted
        ? "âœ…"
        : "â³";
        
      const statusText = isDelayed
        ? "å»¶æœŸ"
        : isCompleted
        ? "å·²å®Œæˆ"
        : "è¿›è¡Œä¸­";
        
      const statusTextColor = isDelayed
        ? "text-red-700"
        : isCompleted
        ? "text-green-700"
        : "text-blue-700";

      reportContent += `
        <div class='p-4 rounded-lg ${statusColor} border shadow-sm hover:shadow-md transition-all duration-300 transform hover:-translate-y-1'>
          <div class="flex justify-between items-start">
            <h3 class='font-medium mb-2 text-gray-800'>${task.name}</h3>
            <span class='${statusTextColor} text-sm font-medium px-2 py-1 rounded-full bg-white shadow-sm'>${statusIcon} ${statusText}</span>
          </div>
          <p class='text-sm mb-1'><span class='font-medium text-gray-600'>è´Ÿè´£äºº:</span> ${task.owner || "æœªæŒ‡å®š"}</p>
          <p class='text-sm mb-1'><span class='font-medium text-gray-600'>è®¡åˆ’æ—¶é—´:</span> ${task.start} ~ ${task.end}</p>
          <p class='text-sm mb-1'><span class='font-medium text-gray-600'>å®é™…å®Œæˆ:</span> ${task.actualEnd || "æœªå®Œæˆ"}</p>
          <p class='text-sm'><span class='font-medium text-gray-600'>æè¿°:</span> ${task.desc || "æ— "}</p>
        </div>
      `;
    });
    
    reportContent += "</div>";
    reportContent += "</section>";
    reportContent += "</div>";

    const summaryDiv = document.getElementById('summary');
    summaryDiv.innerHTML = reportContent;
    summaryDiv.classList.remove('p-4', 'border', 'bg-gray-50');
    summaryDiv.classList.add('space-y-6');

    // åˆå§‹åŒ–å›¾è¡¨ - æ›´å¥½çš„æ ·å¼
    const chart = new CanvasJS.Chart("chartContainer", {
        animationEnabled: true,
        backgroundColor: "#f9fafb",
        theme: "light2",
        title: {
            text: "ä»»åŠ¡çŠ¶æ€åˆ†å¸ƒ",
            fontFamily: "Arial",
            fontSize: 20,
            fontWeight: "normal"
        },
        legend: {
            cursor: "pointer",
            itemclick: toggleDataSeries
        },
        data: [{
            type: "doughnut",
            showInLegend: true,
            indexLabel: "{label}: {y}",
            indexLabelFontSize: 14,
            yValueFormatString: "#,##0",
            dataPoints: [
                { y: completedTasks, label: "å·²å®Œæˆ", color: "#10b981" },
                { y: delayedTasks, label: "å»¶æœŸ", color: "#ef4444" },
                { y: totalTasks - completedTasks - delayedTasks, label: "è¿›è¡Œä¸­", color: "#3b82f6" }
            ]
        }]
    });
    chart.render();
    
    // æ·»åŠ æ—¶é—´çº¿å›¾è¡¨
    const timelineData = [];
    tasks.forEach(task => {
        timelineData.push({
            x: new Date(task.start),
            y: tasks.indexOf(task),
            name: task.name,
            owner: task.owner || "æœªæŒ‡å®š"
        });
        timelineData.push({
            x: new Date(task.end),
            y: tasks.indexOf(task),
            name: task.name,
            owner: task.owner || "æœªæŒ‡å®š"
        });
    });
    
    const timelineChart = new CanvasJS.Chart("timelineChart", {
        animationEnabled: true,
        backgroundColor: "#f9fafb",
        theme: "light2",
        title: {
            text: "é¡¹ç›®æ—¶é—´çº¿",
            fontFamily: "Arial",
            fontSize: 20,
            fontWeight: "normal"
        },
        axisX: {
            valueFormatString: "YYYY-MM-DD"
        },
        axisY: {
            title: "ä»»åŠ¡",
            includeZero: true
        },
        data: [{
            type: "line",
            xValueFormatString: "YYYY-MM-DD",
            dataPoints: timelineData
        }]
    });
    timelineChart.render();
}

// å›¾è¡¨äº¤äº’åŠŸèƒ½
function toggleDataSeries(e) {
    if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
        e.dataSeries.visible = false;
    } else {
        e.dataSeries.visible = true;
    }
    e.chart.render();
}
  function downloadProjectReport() {
    const summaryDiv = document.getElementById("summary");
    const reportContent = summaryDiv.innerText;

    const blob = new Blob([reportContent], { type: "text/markdown" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "é¡¹ç›®åˆ†ææŠ¥å‘Š.md";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // ä½¿ç”¨äº‹ä»¶å§”æ‰˜ä¼˜åŒ–äº‹ä»¶ç»‘å®š
  document.body.addEventListener("click", function (e) {
    if (e.target.matches("#exportMenuButton")) {
      toggleExportMenu();
    }
    // æ·»åŠ å…¶ä»–äº‹ä»¶å¤„ç†
  });

  // å›¾è¡¨è¾…åŠ©å‡½æ•°// æ·»åŠ è¾…åŠ©å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸä¸ºYYYY-MM-DD
  function formatDate(date) {
    const d = new Date(date);
    const year = d.getFullYear();
    const month = String(d.getMonth() + 1).padStart(2, '0');
    const day = String(d.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }
</script>


